<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Touch Fastener Challenge - Paiho Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const TouchFastenerGame = () => {
            const [isPeeling, setIsPeeling] = useState(false);
            const [progress, setProgress] = useState(0);
            const [noiseLevel, setNoiseLevel] = useState(0);
            const [isWoke, setIsWoke] = useState(false);
            const [gameStarted, setGameStarted] = useState(false);

            const audioCtx = useRef(null);
            const noiseNode = useRef(null);
            const gainNode = useRef(null);
            const lastY = useRef(0);

            // åˆå§‹åŒ– Web Audio API æ¨¡æ“¬ç™¾å’Œç²˜æ‰£å¸¶æ’•é–‹è²
            const initAudio = () => {
                if (!audioCtx.current) {
                    audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // å»ºç«‹ç™½å™ªéŸ³ (æ¨¡æ“¬æ’•é–‹è²)
                    const bufferSize = 2 * audioCtx.current.sampleRate;
                    const noiseBuffer = audioCtx.current.createBuffer(1, bufferSize, audioCtx.current.sampleRate);
                    const output = noiseBuffer.getChannelData(0);
                    for (let i = 0; i < bufferSize; i++) {
                        output[i] = Math.random() * 2 - 1;
                    }

                    noiseNode.current = audioCtx.current.createBufferSource();
                    noiseNode.current.buffer = noiseBuffer;
                    noiseNode.current.loop = true;

                    gainNode.current = audioCtx.current.createGain();
                    gainNode.current.gain.value = 0;

                    noiseNode.current.connect(gainNode.current);
                    gainNode.current.connect(audioCtx.current.destination);
                    noiseNode.current.start();
                }
                if (audioCtx.current.state === 'suspended') {
                    audioCtx.current.resume();
                }
            };

            const handleMouseDown = (e) => {
                if (!gameStarted || isWoke) return;
                initAudio();
                setIsPeeling(true);
                lastY.current = e.clientY || e.touches[0].clientY;
            };

            const handleMouseMove = (e) => {
                if (!isPeeling || isWoke) return;
                const currentY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
                const delta = Math.max(0, lastY.current - currentY); // å‘ä¸Šæ’•é–‹
                
                if (delta > 0) {
                    // è¨ˆç®—é€Ÿåº¦èˆ‡å™ªéŸ³
                    const speed = delta * 5; 
                    setNoiseLevel(speed);
                    
                    // æ›´æ–°éŸ³é‡ (æ¨¡æ“¬ç‰©ç†å›é¥‹)
                    if (gainNode.current) {
                        gainNode.current.gain.setTargetAtTime(Math.min(speed / 100, 0.5), audioCtx.current.currentTime, 0.05);
                    }

                    // åˆ¤æ–·æ˜¯å¦åµé†’å¯¶å¯¶ (åŠ é€Ÿåº¦éå¤§)
                    if (speed > 80) {
                        setIsWoke(true);
                        setIsPeeling(false);
                        gainNode.current.gain.value = 0;
                    }

                    // æ›´æ–°é€²åº¦
                    setProgress(prev => {
                        const next = prev + delta * 0.2;
                        if (next >= 100) {
                            setIsPeeling(false);
                            gainNode.current.gain.value = 0;
                            return 100;
                        }
                        return next;
                    });
                }
                lastY.current = currentY;
            };

            const handleMouseUp = () => {
                setIsPeeling(false);
                setNoiseLevel(0);
                if (gainNode.current) {
                    gainNode.current.gain.setTargetAtTime(0, audioCtx.current.currentTime, 0.1);
                }
            };

            return (
                <div 
                    className="flex flex-col items-center justify-center min-h-screen p-4 select-none"
                    onMouseMove={handleMouseMove}
                    onMouseUp={handleMouseUp}
                    onTouchMove={handleMouseMove}
                    onTouchEnd={handleMouseUp}
                >
                    <h1 className="text-4xl font-black mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">
                        PAIHO TOUCH FASTENER
                    </h1>
                    <p className="text-slate-400 mb-8 italic">"Easy Peel, Quiet Motion"</p>

                    <div className="relative w-64 h-64 mb-12 bg-slate-800 rounded-full flex items-center justify-center border-4 border-slate-700 shadow-2xl">
                        {/* å¯¶å¯¶ç‹€æ…‹ */}
                        <div className="text-8xl transition-transform duration-300 transform hover:scale-110">
                            {isWoke ? 'ğŸ˜«' : (progress >= 100 ? 'ğŸ¥³' : 'ğŸ˜´')}
                        </div>
                        
                        {/* å™ªéŸ³è¨ˆé‡è¡¨ */}
                        <div className="absolute inset-0 rounded-full border-t-4 border-red-500 transition-all duration-75"
                             style={{ opacity: noiseLevel / 100, transform: `rotate(${noiseLevel * 1.8}deg)` }}>
                        </div>
                    </div>

                    {!gameStarted ? (
                        <button 
                            onClick={() => setGameStarted(true)}
                            className="bg-emerald-500 hover:bg-emerald-600 px-8 py-3 rounded-full font-bold transition-all transform hover:scale-105"
                        >
                            é–‹å§‹éœéŸ³æŒ‘æˆ°
                        </button>
                    ) : (
                        <div className="w-full max-w-xs">
                            <div className="flex justify-between mb-2 text-sm font-bold">
                                <span>æ’•é–‹é€²åº¦</span>
                                <span>{Math.floor(progress)}%</span>
                            </div>
                            <div 
                                className="h-12 bg-slate-700 rounded-lg relative overflow-hidden cursor-ns-resize border-2 border-slate-600"
                                onMouseDown={handleMouseDown}
                                onTouchStart={handleMouseDown}
                            >
                                <div 
                                    className="absolute bottom-0 left-0 right-0 bg-blue-500 transition-all duration-100"
                                    style={{ height: `${progress}%` }}
                                />
                                <div className="absolute inset-0 flex items-center justify-center text-xs font-bold pointer-events-none text-white/50">
                                    {isPeeling ? 'ç·©æ…¢å‘ä¸Šæ‹–æ‹½...' : 'æŒ‰ä½ä¸¦å‘ä¸Šç·©æ…¢æ’•é–‹'}
                                </div>
                            </div>
                            
                            {isWoke && (
                                <button 
                                    onClick={() => window.location.reload()}
                                    className="mt-6 w-full py-2 bg-red-500 rounded-lg font-bold"
                                >
                                    å¯¶å¯¶é†’äº†ï¼é‡æ–°å˜—è©¦
                                </button>
                            )}
                            {progress >= 100 && (
                                <div className="mt-6 text-center text-emerald-400 font-bold animate-bounce">
                                    æˆåŠŸï¼é«”é©—äº†ç™¾å’Œæ¥µè‡´éœéŸ³æŠ€è¡“
                                </div>
                            )}
                        </div>
                    )}

                    <div className="mt-12 text-slate-500 text-xs text-center max-w-sm">
                        æ­¤äº’å‹•æ¨¡æ“¬ç”±å°ç£ç™¾å’Œ (Taiwan Paiho) æŠ€è¡“å•Ÿç™¼ï¼Œå±•ç¤ºé«˜å“è³ª Touch Fastener åœ¨å‰é›¢æ™‚çš„ç´°è†©éŸ³æ•ˆæ§ç®¡ã€‚
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TouchFastenerGame />);
    </script>
</body>
</html>
